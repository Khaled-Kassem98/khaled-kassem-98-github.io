<!doctype html>
<html lang="ar">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ูู ุงูููุฌุฉ ุฅูู ุงูุจุช โ ุฑุญูุฉ ุงูุตูุช ุงูุฑููู</title>
  <meta name="description"
    content="ูู ุงูููุฌุฉ ุฅูู ุงูุจุช โ ูููุน ุชูุงุนูู ูุดุฑุญ ุงูุตูุช ุงูุฑูููุ ุงูุชูุทูุนุ ุงูุชูููุฉุ ูุถุบุท ุงูุตูุช." />
  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&family=Poppins:wght@400;600&display=swap"
    rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="container">
    <!-- Header -->
    <header>
      <div class="logo">
        <img src="assets/logo.webp" alt="logo">
        <div>
          <div style="font-weight:800;color:var(--muted);font-size:18px">ูู ุงูููุฌุฉ ุฅูู ุงูุจุช</div>
          <div style="font-size:12px;color:#9fb9d0">From Wave to Bit โ Digital Audio</div>
        </div>
      </div>
      <nav>
        <a href="#home">ุงูุฑุฆูุณูุฉ</a>
        <a href="#journey">ุฑุญูุฉ ุงูุตูุช</a>
        <a href="#lab">ูุฎุชุจุฑ ุงูุชูุทูุน</a>
        <a href="#compression">ุถุบุท ุงูุตูุช</a>
      </nav>
    </header>

    <!-- HERO / HOME -->
    <main id="home" class="hero" style="position:relative;
             display:flex;justify-content:center;align-items:center;flex-direction:column;text-align:center;
             padding:60px 20px;color:#e2e8f0;min-height:60vh;overflow:hidden;border-radius:12px;">
      <video autoplay muted loop playsinline
        style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;opacity:0.25;">
        <source src="assets/intro.mp4" type="video/mp4">
        ูุชุตูุญู ูุง ูุฏุนู ุนุฑุถ ุงูููุฏูู.
      </video>
      <div style="max-width:700px; z-index:1;">
        <h1 style="font-size:clamp(20px,3vw,30px);color:#38bdf8;margin-bottom:10px;line-height:1.6;font-weight:700;">
          ๐ ูู ุงูููุฌุฉ ุฅูู ุงูุจูุช: ุฑุญูุฉ ุงูุตูุช ุงูุฑููู
        </h1>
        <p style="font-size:16px;color:#e2e8f0;line-height:1.8;margin:0 auto 18px;max-width:650px;
          text-shadow:0 2px 6px rgba(0,0,0,0.4);">
          ููุตุฉ ุชุนููููุฉ ุชูุงุนููุฉ ูุทูุงุจ ููุฑุฑ <strong style='color:#38bdf8;'>ูุธู ุงููุณุงุฆุท ุงููุชุนุฏุฏุฉ</strong> โ
          ุงุณุชูุดู ููู ูุชุญูู ุงูุตูุช ูู ููุฌุฉ ุฅูู ุจูุงูุงุช ุฑูููุฉุ ูุชุนุฑูู ุนูู ุฎุทูุงุช
          <strong style='color:#38bdf8;'>ุงูุชูุทูุน</strong> ู<strong style='color:#38bdf8;'>ุงูุชูููุฉ</strong>ุ
          ูุงุทููุน ุนูู ุชูููุงุช <strong style='color:#38bdf8;'>ุถุบุท ุงูุตูุช</strong>.
        </p>
        <div style="margin-top:22px;">
          <button class="btn" onclick="scrollToSection('journey')" style="padding:10px 26px; font-size:15px; color:#0f172a;background:#38bdf8; border:none;
             border-radius:8px;  cursor:pointer;transition:0.3s;">
            ุงุจุฏุฃ ุฑุญูุชู
          </button>
        </div>
        <div style="margin-top:14px; font-size:13px; color:#cbd5e1;">
          ุงููุตู ุงูุฑุงุจุน โ ุงูุตูุช ุงูุฑููู (<span style="color:#38bdf8;">BMM601</span>)
        </div>
      </div>
    </main>

    <!-- Journey -->
    <section id="journey" class="card" aria-labelledby="journey-title" style="text-align:center;">
      <h2 id="journey-title" class="section-title">๐ง ุฑุญูุฉ ุงูุตูุช ูู ุงูููุงุก ุฅูู ุงูุจุช</h2>
      <!-- ุดุฑุญ ุฑุญูุฉ ุงูุตูุช -->
      <div style="max-width:700px; margin:0 auto 24px;text-align:center;color:#dbeafe;line-height:1.9;font-size:17px;">
        <p style="margin-bottom:18px;">
          ุงูุตูุช ููุฌุฉ ูููุงููููุฉ ุชูุชุดุฑ ูู ุงูููุงุก. ุนูุฏ ูุตูููุง ุฅูู ุงูุฃุฐูุ ุชูุญูููู ุงูุฐุจุฐุจุงุช ุฅูู ุฅุดุงุฑุงุช ููุฑุจุงุฆูุฉ
          ุชูุชูู ุนุจุฑ <strong style='color:#38bdf8;'>ุงูุนุตุจ ุงูุณูุนู</strong> ุฅูู ุงูุฏูุงุบ ููุชู ุชูุณูุฑูุง ูุฃุตูุงุช ูููููุฉ.
        </p>
        <p style="margin-bottom:16px;">
          ููุชูุท <strong style='color:#38bdf8;'>ุงูุญุงุณูุจ</strong> ูุฐู ุงูููุฌุฉ ููุฑููููุง ุนุจุฑ ุนูููุชู
          <strong style='color:#38bdf8;'>ุงูุชูุทูุน</strong> ู<strong style='color:#38bdf8;'>ุงูุชูููุฉ</strong>
          ููุญุตูู ุนูู ุชูุซูู ุฑููู ุฏููู ูููู ุชุฎุฒููู ุฃู ูุนุงูุฌุชู.
        </p>

        <p style="font-size:15px;color:#94a3b8; margin-top:22px;line-height:1.8;">
          ๐ง ุงูุฑุณู ุฃุฏูุงู ููุถูุญ ุฑุญูุฉ ุงูุตูุช ุฏุงุฎู ุงูุฃุฐู โ ูุฑูุฑ ุงููุคุดุฑ ููู ุงูุฃุฌุฒุงุก ููุนุฑูุฉ ูุธุงุฆููุง.
        </p>
      </div>
      <!-- ุงูุฑุณู ุงูุชูุงุนูู ูุตุบูุฑ -->
      <div class="ear-stage" id="earStage" style="position:relative;max-width:600px;margin:30px auto;border-radius:12px;overflow:hidden;
        background: rgba(255, 255, 255, 0.85);padding:25px 0;">
        <img src="assets/ear.webp" alt="ุฑุณู ูุงูุนู ููุฃุฐู ุงูุจุดุฑูุฉ"
          style="width:100%;height:auto;display:block;border-radius:12px;">
        <!-- ุงูููุงุท ุงูุชูุงุนููุฉ -->
        <div class="hotspot" data-name="ุงูุตููุงู" data-text="ูุฌูุน ุงูููุฌุงุช ุงูุตูุชูุฉ ูููุฌููุง ูุญู ุงูููุงุฉ ุงูุณูุนูุฉ ุงูุฎุงุฑุฌูุฉ."
          style="top:32%; left:14%; width:8%; height:12%;"></div>
        <div class="hotspot" data-name="ููุงุฉ ุงูุณูุน" data-text="ุชููู ุงูุงูุชุฒุงุฒุงุช ุงูุตูุชูุฉ ูู ุงูุตููุงู ุฅูู ุบุดุงุก ุงูุทุจู."
          style="top:45%; left:33%; width:9%; height:6%;"></div>
        <div class="hotspot" data-name="ุบุดุงุก ุงูุทุจู"
          data-text="ุบุดุงุก ุฑููู ููุชุฒ ุนูุฏูุง ุชุตูู ุงูููุฌุงุช ุงูุตูุชูุฉ ููููู ุงูุทุงูุฉ ุงููููุงููููุฉ ุฅูู ุงูุนุธููุงุช."
          style="top:47%; left:49%; width:6%; height:10%;"></div>
        <div class="hotspot" data-name="ุงูุนุธููุงุช ุงูุซูุงุซ"
          data-text="ุงููุทุฑูุฉ ูุงูุณูุฏุงู ูุงูุฑูุงุจ: ุชุถุฎูู ุงูุงูุชุฒุงุฒ ูุชูููู ุฅูู ุงูุฃุฐู ุงูุฏุงุฎููุฉ."
          style="top:47%; left:58%; width:8%; height:10%;"></div>
        <div class="hotspot" data-name="ุงููููุนุฉ"
          data-text="ุชุญููู ุงูุงูุชุฒุงุฒุงุช ุฅูู ุณูุงูุงุช ุนุตุจูุฉ ุนุจุฑ ุงูุฎูุงูุง ุงูุดุนุฑูุฉ ุงูุชู ุชููู ุงูุฅุดุงุฑุฉ ุฅูู ุงูุฏูุงุบ ุนุจุฑ ุงูุนุตุจ ุงูุณูุนู."
          style="top:55%; left:70%; width:9%; height:12%;"></div>
        <div class="hotspot" data-name="ุงูุฎูุงูุง ุงูุดุนุฑูุฉ"
          data-text="ุงูุฎูุงูุง ุงูุดุนุฑูุฉ ูู ุงูุฃุฐู ุงูุฏุงุฎููุฉ ุชุณุชูุจู ุงูุงูุชุฒุงุฒุงุช ูุชุญูููุง ุฅูู ุณูุงูุงุช ุนุตุจูุฉ ุชูุฑุณู ุฅูู ุงูุฏูุงุบ ุนุจุฑ ุงูุนุตุจ ุงูุณูุนู."
          style="top:80%; left:60%; width:10%; height:10%;"></div>
        <div class="popup" id="earPopup">
          <h2 id="earTitle"></h2>
          <p id="earText"></p>
        </div>
      </div>
      <style>
        .ear-stage .hotspot {
          position: absolute;
          border-radius: 50%;
          background: rgba(34, 197, 94, 0.25);
          cursor: pointer;
          transition: all .25s ease;
        }

        .ear-stage .hotspot:hover {
          background: rgba(34, 197, 94, 0.45);
          transform: scale(1.1);
        }

        #earPopup {
          position: absolute;
          display: none;
          min-width: 150px;
          background: rgba(11, 18, 32, 0.95);
          color: #fff;
          padding: 6px 8px;
          border-radius: 8px;
          font-size: 12px;
          line-height: 1.4;
          z-index: 10;
          box-shadow: 0 4px 10px #0005;
        }

        #earPopup h2 {
          font-size: 13px;
          margin: 0 0 3px;
          color: #22c55e;
        }

        #earPopup::after {
          content: '';
          position: absolute;
          bottom: -6px;
          right: 20px;
          border-width: 6px;
          border-style: solid;
          border-color: #0b1220 transparent transparent transparent;
        }
      </style>
      <script>
        const popup = document.getElementById('earPopup');
        const title = document.getElementById('earTitle');
        const text = document.getElementById('earText');
        const stage = document.getElementById('earStage');
        // ุฅุนุฏุงุฏ ููุถุน ุซุงุจุช ูุณุจู ุฃุณูู ููุชุตู ุงูููุทูุฉ
        function showPopup(el) {
          const stageRect = stage.getBoundingClientRect();
          const rect = el.getBoundingClientRect();
          title.textContent = el.dataset.name;
          text.textContent = el.dataset.text;
          popup.style.display = 'block';
          popup.style.top = (rect.top - stageRect.top - 50) + 'px';
          popup.style.left = (rect.left - stageRect.left + rect.width / 2 - popup.offsetWidth / 2) + 'px';
        }
        function hidePopup() {
          popup.style.display = 'none';
        }
        document.querySelectorAll('.ear-stage .hotspot').forEach(el => {
          // ุฒูุงุฏุฉ ูุณุงุญุฉ ุงูุญุณุงุณูุฉ ูููููุง ูุชุฌูุจ ุชูุทุน ุงููุคุดุฑ ุนูุฏ ุงูุฃุทุฑุงู
          el.style.padding = '6px';
          el.style.margin = '-6px';

          el.addEventListener('mouseenter', () => showPopup(el));
          el.addEventListener('mouseleave', hidePopup);
        });
        // ููุน ุงููููุถ ุงููุงุชุฌ ุนู ุชูุฑุงุฑ ุงูุญุณุงุจ ุฃุซูุงุก ุงูุญุฑูุฉ ุฏุงุฎู ููุณ ุงูุนูุตุฑ
        stage.addEventListener('mousemove', e => {
          if (!popup.style.display || popup.style.display === 'none') return;
          e.stopPropagation();
        });
      </script>
    </section>

    <!-- SECTION: Sampling & Quantization Lab -->
    <section id="lab" class="card" aria-labelledby="lab-title" style="padding:60px 20px; text-align:center;">
      <h2 id="lab-title" class="section-title" style="color:#38bdf8; margin-bottom:20px;">
        ๐งช ูุฎุชุจุฑ ุงูุชูุทูุน ูุงูุชูููุฉ (Sampling & Quantization Lab)
      </h2>
      <!-- ูุต ุชูููุฏู -->
      <p style="max-width:750px;margin:auto;color:#cbd5e1;line-height:1.9;font-size:17px;margin-bottom:32px;">
        ููุถูุญ ูุฐุง ุงููุฎุชุจุฑ ุชุฃุซูุฑ ูููู ูู <strong style="color:#38bdf8;">ูุนุฏู ุงูุชูุทูุน (Sampling Rate)</strong>
        ู<strong style="color:#38bdf8;">ุนุฏุฏ ุงูุจุชุงุช (Bit Depth)</strong> ุนูู ุฌูุฏุฉ ุงูุตูุช.
        ููููู ุชุนุฏูู ุงูููู ุฃุฏูุงู ูููุงุญุธุฉ ุงูุชุบููุฑุงุช ุนูู ุดูู ุงูููุฌุฉ ูุฌูุฏุฉ ุงูุตูุช ุงููุงุชุฌ.
      </p>
      <!-- ูุงุฌูุฉ ุงูุชูุงุนู -->
      <div style="max-width:900px;margin:auto;background:#0f172a;border-radius:12px;padding:30px;
        box-shadow:0 4px 20px #00000040;">
        <!-- Sliders -->
        <div style="margin-bottom:30px;text-align:right;">
          <label for="sampleRate" style="color:#93c5fd;font-size:15px;">ูุนุฏู ุงูุชูุทูุน (Hz): <span
              id="rateValue">22050</span></label>
          <input type="range" id="sampleRate" min="8000" max="44100" step="1000" value="22050"
            style="width:100%;margin:10px 0;">
          <label for="bitDepth" style="color:#93c5fd;font-size:15px;">ุนุฏุฏ ุงูุจุชุงุช (Bit Depth): <span
              id="bitValue">8</span></label>
          <input type="range" id="bitDepth" min="4" max="16" step="1" value="8" style="width:100%;margin:10px 0;">
        </div>
        <!-- Canvas ูุนุฑุถ ุงูููุฌุฉ -->
        <canvas id="waveCanvas" width="850" height="200"
          style="width:100%;border-radius:8px;background:#1e293b;"></canvas>
        <!-- ููุงุญุธุงุช ุงููุณุชุฎุฏู -->
        <p id="observation" style="color:#94a3b8;margin-top:20px;font-size:15px;">ุบููุฑ ุงูููู ุฃุนูุงู ูููุงุญุธุฉ ุฃุซุฑูุง ุนูู
          ุงูููุฌุฉ.</p>
      </div>
      <!-- ููุฑุฉ ุนูููุฉ -->
      <div style=" max-width:820px; margin:40px auto;color:#dbeafe;font-size:17px;line-height:2;
        text-align:right;direction:rtl;">
        <p style="margin-bottom:10px;">
          <strong style="color:#38bdf8;font-size:18px;">ุงููุจุฏุฃ ุงูุนููู:</strong>
          ูุนุชูุฏ ุชูุซูู ุงูุตูุช ุฑูููุงู ุนูู ูุจุฏุฃูู ุฃุณุงุณููู ููุง
          <strong style="color:#38bdf8;">ุงูุชูุทูุน (Sampling)</strong> ู
          <strong style="color:#38bdf8;">ุงูุชูููุฉ (Quantization)</strong>.
        </p>
        <p style="margin-bottom:10px;color:#cbd5e1;">
          ูููุงู ูู <strong style="color:#38bdf8;">ูุธุฑูุฉ ูุงููููุณุช (Nyquist)</strong>ุ
          ูุฌุจ ุฃู ูููู <strong>ูุนุฏู ุงูุชูุทูุน</strong>
          ุถุนู ุฃุนูู ุชุฑุฏุฏ ููุฌูุฏ ูู ุงูุฅุดุงุฑุฉ ุงูุฃุตููุฉ ูุถูุงู ุฅุนุงุฏุฉ ุจูุงุก ุฏูููุฉ ุฏูู ููุฏ ูููุนูููุงุช.
        </p>
        <p style="margin:0;color:#cbd5e1;">
          ุฃูุง <strong>ุนุฏุฏ ุงูุจุชุงุช (Bit Depth)</strong> ููุคุซุฑ ุนูู
          <strong style="color:#38bdf8;">ูุณุจุฉ ุงูุฅุดุงุฑุฉ ุฅูู ุงูุถุฌูุฌ (SNR)</strong>ุ
          ุญูุซ ุฅู ูู ุฒูุงุฏุฉ ุจููุฏุงุฑ <strong>1 ุจุช</strong>
          ุชูุญุณููู ุฌูุฏุฉ ุงูุฅุดุงุฑุฉ ุจูุญู <strong style="color:#38bdf8;">6 ุฏูุณูุจู</strong>.
        </p>
      </div>

    </section>

    <!-- ุณูุฑุจุช ุชูุงุนูู -->
    <script>
      const canvas = document.getElementById('waveCanvas');
      const ctx1 = canvas.getContext('2d');
      const rateSlider = document.getElementById('sampleRate');
      const bitSlider = document.getElementById('bitDepth');
      const rateValue = document.getElementById('rateValue');
      const bitValue = document.getElementById('bitValue');
      const observation = document.getElementById('observation');

      function drawWave(rate, bits) {
        ctx1.clearRect(0, 0, canvas.width, canvas.height);
        const amplitude = canvas.height / 3;
        const mid = canvas.height / 2;
        ctx1.beginPath();
        ctx1.moveTo(0, mid);

        const step = canvas.width / 200;
        for (let x = 0; x < canvas.width; x += step) {
          const freq = 2 * Math.PI * (rate / 44100);
          const y = mid + amplitude * Math.sin(x * freq);
          ctx1.lineTo(x, y);
        }
        ctx1.strokeStyle = '#38bdf8';
        ctx1.lineWidth = 2;
        ctx1.stroke();

        // ููุงุท ุงูุชูููุฉ ุงูุชูุฑูุจูุฉ
        const quantStep = Math.pow(2, bits);
        ctx1.fillStyle = '#f97316';
        for (let x = 0; x < canvas.width; x += 25) {
          const freq = 2 * Math.PI * (rate / 44100);
          const y = mid + amplitude * Math.sin(x * freq);
          const qY = Math.round(y / quantStep) * quantStep;
          ctx1.beginPath();
          ctx1.arc(x, qY, 2, 0, 2 * Math.PI);
          ctx1.fill();
        }
      }

      function update() {
        const rate = parseInt(rateSlider.value);
        const bits = parseInt(bitSlider.value);
        rateValue.textContent = rate;
        bitValue.textContent = bits;
        drawWave(rate, bits);

        if (rate < 16000)
          observation.textContent = "ุฌูุฏุฉ ููุฎูุถุฉ โ ูุง ูููู ุชูุซูู ุงูุชุฑุฏุฏุงุช ุงูุนุงููุฉ (ุชุญุช ุญุฏ ูุงููููุณุช).";
        else if (bits < 8)
          observation.textContent = "ุฌูุฏุฉ ูุชูุณุทุฉ โ ุฒูุงุฏุฉ ุนุฏุฏ ุงูุจุชุงุช ุชููู ุงูุชุดููุด ุงููุงุชุฌ ุนู ุงูุชูููุฉ.";
        else
          observation.textContent = "ุฌูุฏุฉ ูุฑุชูุนุฉ โ ุชูุซูู ุฌูุฏ ููุชุฑุฏุฏุงุช ูุน ุถุฌูุฌ ููุฎูุถ.";
      }

      rateSlider.addEventListener('input', update);
      bitSlider.addEventListener('input', update);
      drawWave(22050, 8);
    </script>

    <!-- Compression -->
    <section id="compression" class="card" aria-labelledby="comp-title">
      <h2 id="comp-title" class="section-title">๐๏ธ ุงููู ุถุบุท ุงูุตูุช</h2>
      <div class="grid">
        <div>
          <p class="muted">ุดุฑุญ ูุจุณูุท ูุฃููุงุน ุงูุถุบุท:</p>
          <div style="display:grid;gap:10px;margin-top:12px">
            <div style="background:#021826;padding:12px;border-radius:8px">
              <strong>PCM</strong>
              <div class="muted">ุชุฎุฒูู ูู ุนููุฉ ููุง ูู โ ุฌูุฏุฉ ุนุงููุฉุ ุญุฌู ูุจูุฑ.</div>
              <div style="margin-top:6px"><button class="btn" onclick="playCompression('pcm')">ุงุณุชูุน PCM</button></div>
            </div>
            <div style="background:#021826;padding:12px;border-radius:8px">
              <strong>DPCM</strong>
              <div class="muted">ุชุฎุฒูู ุงููุฑู ุจูู ุงูุนููุงุช โ ุญุฌู ุฃุตุบุฑ ูุน ุฌูุฏุฉ ุฌูุฏุฉ.</div>
              <div style="margin-top:6px"><button class="btn" onclick="playCompression('dpcm')">ุงุณุชูุน DPCM</button>
              </div>
            </div>
            <div style="background:#021826;padding:12px;border-radius:8px">
              <strong>Delta Modulation</strong>
              <div class="muted">ุชุฎุฒูู ุงุชุฌุงู ุงูุชุบููุฑ ููุท โ ุญุฌู ุตุบูุฑุ ุฌูุฏุฉ ููุฎูุถุฉ.</div>
              <div style="margin-top:6px"><button class="btn" onclick="playCompression('delta')">ุงุณุชูุน Delta</button>
              </div>
            </div>
          </div>
        </div>
        <div>
          <canvas id="sizeChart" width="400" height="260" style="background:#001820;border-radius:8px"></canvas>
          <div style="color:#9fb9d0;margin-top:8px">ูุฎุทุท ุชูุถูุญู ูุญุฌู ุงูููู ููุงุจู ุฌูุฏุฉ ุงููููุฐุฌ (ูุญุงูุงุฉ)</div>
        </div>
      </div>
    </section>

    <footer>
      ยฉ ุฌุงูุนุฉ โ ูุดุฑูุน ูุตู SVU โ ุชุตููู ูุชูููุฐ: [ุฃุณูุงุก ุงูุทูุงุจ]
    </footer>
  </div>

  <script>
    /* ---------- small helpers ---------- */
    function scrollToSection(id) {
      document.querySelector('#' + id).scrollIntoView({ behavior: 'smooth' });
    }

    /* ---------- LAB: sampling & quantization simulation ---------- */
    const srEl = document.getElementById('sampleRate');
    const bdEl = document.getElementById('bitDepth');
    const srVal = document.getElementById('rateValue');
    const bdVal = document.getElementById('bitValue');
    const playBtn = document.getElementById('playBtn');
    const waveCanvas = document.getElementById('waveCanvas');
    const ctx = waveCanvas.getContext('2d');
    let example = 'tone';
    srEl.addEventListener('input', () => { srVal.textContent = srEl.value });
    bdEl.addEventListener('input', () => { bdVal.textContent = bdEl.value });

    function setExample(name) {
      example = name;
      document.getElementById('labNote').textContent = "ูุซุงู: " + (name === 'speech' ? 'ููุทุน ููุงูู' : 'ูุบูุฉ ูุฑูุจุฉ');
    }

    /* generate source buffer (mono) */
    function generateSourceBuffer(lengthSeconds = 2, sampleRate = 44100) {
      const sr = sampleRate;
      const len = Math.floor(lengthSeconds * sr);
      const arr = new Float32Array(len);
      for (let i = 0; i < len; i++) {
        const t = i / sr;
        // choose example
        if (example === 'speech') {
          // synthetic vowel-like short waveform: sum of few sinusoids
          arr[i] = 0.4 * Math.sin(2 * Math.PI * 220 * t) + 0.25 * Math.sin(2 * Math.PI * 440 * t) + 0.08 * Math.sin(2 * Math.PI * 880 * t);
        } else {
          // tone composite: 440 + 880
          arr[i] = 0.5 * Math.sin(2 * Math.PI * 440 * t) + 0.3 * Math.sin(2 * Math.PI * 880 * t);
        }
      }
      // normalize
      let max = 0; for (let v of arr) if (Math.abs(v) > max) max = Math.abs(v);
      if (max > 0) { for (let i = 0; i < arr.length; i++) arr[i] /= max; }
      return { arr, sr };
    }

    /* quantize float32 array to N bits */
    function quantizeArray(floatArr, bits) {
      const levels = Math.pow(2, bits);
      const out = new Float32Array(floatArr.length);
      for (let i = 0; i < floatArr.length; i++) {
        // map [-1,1] -> [0,levels-1]
        const scaled = Math.round(((floatArr[i] + 1) / 2) * (levels - 1));
        // map back
        out[i] = (scaled / (levels - 1)) * 2 - 1;
      }
      return out;
    }

    /* downsample original to simulate lower sampling rate then upsample back (simple) */
    function resampleFloat(arr, srcRate, dstRate) {
      if (srcRate === dstRate) return arr;
      const len = Math.floor(arr.length * dstRate / srcRate);
      const out = new Float32Array(len);
      const ratio = srcRate / dstRate;
      for (let i = 0; i < len; i++) {
        const srcIndex = Math.floor(i * ratio);
        out[i] = arr[srcIndex] || 0;
      }
      return out;
    }

    /* draw original and quantized wave */
    function drawWaves(original, quantized) {
      const w = waveCanvas.width;
      const h = waveCanvas.height;
      ctx.clearRect(0, 0, w, h);
      // top half: original
      ctx.lineWidth = 1.5;
      ctx.strokeStyle = "#60A5FA";
      ctx.beginPath();
      const len = original.length;
      for (let i = 0; i < len; i++) {
        const x = Math.floor(i / len * w);
        const y = (h / 4) * (1 - original[i]) + 10;
        if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
      }
      ctx.stroke();
      // bottom half: quantized
      ctx.lineWidth = 1.2;
      ctx.strokeStyle = "#C084FC";
      ctx.beginPath();
      const lenQ = quantized.length;
      for (let i = 0; i < lenQ; i++) {
        const x = Math.floor(i / lenQ * w);
        const y = (h * 3 / 4) * (1 - quantized[i]) + 10;
        if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
      }
      ctx.stroke();

      // labels
      ctx.fillStyle = "#79bfe0"; ctx.font = "12px Tajawal";
      ctx.fillText("ุงูููุฌุฉ ุงูุฃุตููุฉ", 8, 14);
      ctx.fillText("ุจุนุฏ ุงูุชูููุฉ", 8, h * 0.75 + 4);
    }

    /* create audio buffer from Float32Array and play */
    async function playFloatArray(floatArr, sr) {
      ensureCtx();
      const buf = audioCtx.createBuffer(1, floatArr.length, sr);
      buf.getChannelData(0).set(floatArr);
      const src = audioCtx.createBufferSource();
      src.buffer = buf;
      const gain = audioCtx.createGain(); gain.gain.value = 0.12;
      src.connect(gain); gain.connect(audioCtx.destination);
      src.start();
    }

    /* main: process parameters then play and draw */
    async function playProcessed() {
      playBtn.disabled = true; playBtn.textContent = "ุฌุงุฑู ุงูุชุดุบูู...";
      const srTarget = parseInt(srEl.value, 10);
      const bd = parseInt(bdEl.value, 10);
      // generate high-quality source at 44100
      const source = generateSourceBuffer(2, 44100);
      // resample to target then quantize then upsample to 44100 for playback
      const down = resampleFloat(source.arr, 44100, srTarget);
      const quant = quantizeArray(down, bd);
      // upsample naive (repeat)
      const up = resampleFloat(quant, srTarget, 44100);
      drawWaves(source.arr.slice(0, Math.min(2000, source.arr.length)), up.slice(0, Math.min(2000, up.length)));
      await playFloatArray(up, 44100);
      playBtn.disabled = false; playBtn.textContent = "ุงุณุชูุน ุงูุขู";
    }

    /* ---------- Compression demos (simple algorithms) ---------- */

    /* DPCM: predict previous sample */
    function dpcmEncode(arr, bits) {
      const levels = Math.pow(2, bits);
      const out = new Float32Array(arr.length);
      let prev = 0;
      for (let i = 0; i < arr.length; i++) {
        const diff = arr[i] - prev;
        // quantize diff into limited levels
        const scaled = Math.round(((diff + 1) / 2) * (levels - 1));
        const rec = (scaled / (levels - 1)) * 2 - 1;
        prev = prev + rec;
        out[i] = prev;
      }
      return out;
    }

    /* Delta modulation: binary step up/down by step */
    function deltaMod(arr, step = 0.05) {
      const out = new Float32Array(arr.length);
      let prev = 0;
      for (let i = 0; i < arr.length; i++) {
        const bit = (arr[i] >= prev) ? 1 : -1;
        prev = prev + bit * step;
        out[i] = prev;
      }
      return out;
    }

    /* play compression variant */
    // AudioContext ููุญูุฏ ูุน ุชูุนูู ุจุนุฏ ุฃูู ููุฑุฉ
    let audioCtx;
    function ensureCtx() {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') {
        const resume = () => { audioCtx.resume(); window.removeEventListener('click', resume); };
        window.addEventListener('click', resume, { once: true });
      }
    }
    async function playCompression(type) {
      ensureCtx();
      const src = generateSourceBuffer(2, 44100);
      let processed;
      if (type === 'pcm') {
        processed = src.arr;
      } else if (type === 'dpcm') {
        processed = dpcmEncode(src.arr, 8); // e.g. 8-bit differences
      } else {
        processed = deltaMod(src.arr, 0.03);
      }
      await playFloatArray(processed, 44100);
    }

    /* ---------- Chart for compression sizes (mock data) ---------- */
    const chartCtx = document.getElementById('sizeChart').getContext('2d');
    const sizeChart = new Chart(chartCtx, {
      type: 'bar',
      data: {
        labels: ['PCM', 'DPCM', 'Delta'],
        datasets: [{
          label: 'Estimated file size (KB)',
          data: [450, 280, 110],
          backgroundColor: ['#60A5FA', '#C084FC', '#7dd3fc']
        }, {
          label: 'Perceived quality (relative)',
          data: [95, 80, 45],
          type: 'line',
          yAxisID: 'y1',
          borderColor: '#cbd5e1',
          fill: false,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true, position: 'left' },
          y1: { position: 'right', beginAtZero: true, max: 100 }
        },
        plugins: { legend: { labels: { color: '#9fb9d0' } } }
      }
    });

    /* set initial example */
    setExample('tone');

  </script>
</body>

</html>